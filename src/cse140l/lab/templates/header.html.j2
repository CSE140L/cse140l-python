<style>
    /* UCSD-Inspired Color Palette */
    :root {
        --ucsd-blue-dark: #003865;
        --ucsd-blue-light: #B0E0E6;
        --status-success: #28A745; /* Green */
        --status-success-light: #DCF8E5; /* Very Light Green BG */
        --status-error: #DC3545; /* Red */
        --status-warning: #FFC107; /* Yellow */
        --ucsd-neutral-bg: #F0F8FF;
        --ucsd-code-bg: #E6E6FA;
    }

    /* Global and Status Styles */
    body {
        font-family: 'Arial', sans-serif;
        background-color: var(--ucsd-neutral-bg);
        color: var(--ucsd-blue-dark);
        padding: 20px;
    }
    h1 {
        background-color: var(--ucsd-blue-dark);
        color: var(--status-warning);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 30px;
    }
    h2 {
        color: var(--ucsd-blue-dark);
        border-bottom: 2px solid var(--ucsd-blue-light);
        padding-bottom: 5px;
        margin-top: 25px;
    }
    .file-status {
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }

    /* --- SUCCESS STATE (GREEN) --- */
    .status-success {
        background-color: var(--status-success-light);
        border: 2px solid var(--status-success);
    }
    .status-success h2, .status-success p {
        color: var(--status-success);
        border-bottom: none;
    }
    /* ----------------------------- */

    /* Error State (Red) */
    .status-error {
        background-color: #F8D7DA;
        border: 2px solid var(--status-error);
    }
    .status-error h2, .status-error p {
        color: var(--status-error);
    }

    /* Code and List Styling (Retained) */
    code {
        background-color: var(--ucsd-code-bg);
        padding: 2px 4px;
        border-radius: 4px;
        color: var(--ucsd-blue-dark);
    }
    ul {
        list-style: none;
        padding-left: 0;
    }
    li {
        background-color: var(--ucsd-blue-light);
        margin-bottom: 5px;
        padding: 8px;
        border-left: 5px solid var(--ucsd-blue-dark);
        border-radius: 4px;
    }

    /* Circuit Screenshot Styling (Retained) */
    .circuit-container {
        padding: 15px;
        border: 1px solid var(--ucsd-blue-light);
        border-radius: 6px;
        margin-bottom: 20px;
        background-color: #FFFFFF;
    }
    .circuit-image img {
        width: 100%;
        max-width: 800px;
        height: auto;
        display: block;
        border: 1px dashed var(--ucsd-blue-light);
        padding: 10px;
    }

    /* Scrollbox Styles (Retained) */
    .scrollable-section {
        max-height: 600px;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid var(--ucsd-blue-dark);
        border-radius: 8px;
        background-color: var(--ucsd-neutral-bg);
    }
</style>

<h1>UCSD CSE 140L Lab {{lab_number}} Report</h1>

<div class="file-status {% if missing_files %}status-error{% else %}status-success{% endif %}">
    {% if missing_files %}
        <h2>Missing Files Detected:</h2>
        <p>We require the following file(s) for grading. Please check your submission and file names correctly!</p>
        <ul>
            {% for missing in missing_files %}
                <li>Missing File: <code>{{ missing }}.dig</code></li>
            {% endfor %}
        </ul>
    {% else %}
        <h2>All Required Files Submitted!</h2>
        <p>Proceeding to circuit analysis and grading.</p>
    {% endif %}
</div>

<div>
    <h2>Submitted Circuit Analysis:</h2>

    <div class="scrollable-section">
        {% for top_level, base64_png_data, analysis_errors in circuit_info %}
            <div class="circuit-container">
                <h3>Circuit File: <code>{{ top_level }}.dig</code></h3>

                <div class="circuit-image">
                    <p><strong>Screenshot of Circuit:</strong></p>
                    <img src="{{ base64_png_data }}" alt="Screenshot of {{ top_level }} Circuit" />
                </div>

                {% if analysis_errors %}
                    <div class="status-error" style="background-color: #F8D7DA; border-color: var(--status-error); padding: 10px;">
                        <h4>Circuit Analysis Errors: </h4>
                        <ul>
                            {% for error in analysis_errors %}
                                <li style="border-left: 5px solid var(--status-error); background-color: #FFF0F5;">
                                    Error in <code>{{ top_level }}</code>: {{ error }}
                                </li>
                            {% endfor %}
                        </ul>
                        <p style="color: var(--status-error); font-weight: bold;">Please fix these issues before resubmitting.</p>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
</div>