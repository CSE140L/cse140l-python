{% extends "base.html.j2" %}

{% block title %}Report Locked{% endblock %}

{% block styles %}
<style>
    #countdown {
        font-size: 1.5rem;
        color: var(--ucsd-blue);
        font-weight: 500;
        margin-top: 1.5rem;
    }
    .centered-box strong {
        color: var(--text-dark);
    }
</style>
{% endblock %}

{% block content %}
<div class="centered-container">
    <div class="centered-box" data-locked-until="{{ locked_until_iso }}">
        <h1>Report Locked</h1>
        <p>The report for <strong>Lab {{ lab_number }}</strong> is not yet available.</p>
        <p>It will be unlocked on {{ locked_until_str }}.</p>
        <div id="countdown"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('.centered-box');
        const lockedUntilDate = new Date(container.dataset.lockedUntil);
        const countdownElement = document.getElementById('countdown');

        if (isNaN(lockedUntilDate)) {
            countdownElement.innerHTML = "Could not determine unlock time.";
            return;
        }

        const interval = setInterval(() => {
            const now = new Date();
            const difference = lockedUntilDate - now;

            if (difference <= 0) {
                clearInterval(interval);
                countdownElement.innerHTML = "Report unlocked. Refreshing...";
                window.location.reload();
                return;
            }

            const days = Math.floor(difference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((difference % (1000 * 60)) / 1000);

            countdownElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }, 1000);
    });
</script>
{% endblock %}